# **Project Requirements Document: NoteHelper**

The following table outlines the detailed functional requirements of The NoteHelper website.

| Requirement ID | Description             | User Story                                                                                                                                                                | Expected Behavior / Outcome                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **FR001**      | Create a Territory       | As a user, I want to be able to create a territory to later assign to customers and sellers.                                                                              | The system should provide a way for the user to initiate the creation of a new territory, presenting a list of existing territories to prevent duplicates from being created. A territory does not have to have a seller associated with it but can have multiple sellers associated with it.                                                                                                                                                |
| **FR002**      | Create a Seller          | As a user, I want to be able to create a Seller that can be assigned a territory and later be assigned to a customer.                                                     | The system should provide a way for the user to initiate the creation of a new seller. It should provide a way to assign an existing territory or create a new one if needed. It should show all existing sellers to prevent duplication.                                                                                                                                                                                                       |
| **FR003**      | Create a Customer        | As a user, I want to be able to create a Customer that can be assigned a seller and territory, with a TPID and optional URL.                                              | The system should provide a way to initiate the creation of a customer with a numerical TPID (Top Parent ID) field. It should allow assigning an existing territory and seller but not require this. If a seller is selected that is already assigned a territory, automatically pick that territory. A customer can exist without a territory or seller. The user can optionally provide a URL that the TPID will link to when displayed. |
| **FR004**      | Create a Topic           | As a user, I want to be able to create topics that I can then tag my calls with so I can search by tag later.                                                             | The system should provide a way for the user to initiate the creation of a Topic. It should show all other topics available to prevent duplication.                                                                                                                                                                                                                                                                                     |
| **FR005**      | Create a Call Log        | As a user, I want to be able to create a call log that I can assign to a customer and tag with Topics. I want this to be rich text and be able to paste screenshots.      | The system should provide a clear way to create a Call Log. It should allow but not require adding a seller, territory, and multiple topics. It should allow inline creation of new topics. If a seller with a territory is selected, auto-select that territory. It should include a rich text editor for call details with screenshot pasting. It should auto-choose the current date/time but allow overrides. Only one seller can be assigned to a call. |
| **FR006**      | View/Edit a Territory    | As a user, I want to pick one of my territories to view and see accounts and recent calls, and toggle an edit view to update its name.                                    | The system should allow viewing a specific territory, its details, related sellers, and calls in the last week. It should allow editing the territory name.                                                                                                                                                                                                                                                                                  |
| **FR007**      | View/Edit a Seller       | As a user, I want to see my sellers and make changes to them as needed.                                                                                                    | The system should allow viewing specific sellers and editing their name and territory. It should list all their customers and the date of the most recent call for each, sorted by most recent. A seller can have multiple customers.                                                                                                                                                                                                       |
| **FR008**      | View/Edit a Customer     | As a user, I want to view a single customer, edit their name, TPID, TPID URL, seller, and territory if needed, and see all calls for them.                               | The system should allow viewing specific customers, editing their name, TPID, optional TPID URL, seller, and territory, and listing all call logs for that customer with dates, sorted by most recent first. When displaying the customer name, the TPID should be shown in parentheses and be clickable (linking to the TPID URL) if a URL has been configured.                                                                          |
| **FR009**      | View/Edit Topics         | As a user, I want to be able to view all available topics and edit any as needed.                                                                                          | The system should allow viewing all topics and editing their names and descriptions.                                                                                                                                                                                                                                                                                                                                                        |
| **FR010**      | View/Edit a Call Log     | As a user, I want to be able to view specific call logs and make changes as needed.                                                                                        | The system should allow viewing specific call logs and updating their topics, contents, or seller if needed.                                                                                                                                                                                                                                                                                                                                 |
| **FR011**      | View notes that match a filter | As a user, I want to view my call logs in any filterable way. I want to view per customer, per territory, by topics, grouped with most recent calls first.          | The system should provide a way to view call logs with filters. Logs should be grouped by customer (ordered by most recent call), then those customers grouped by seller. The grouping structure is: Seller → Customers (sorted by most recent call) → Calls (sorted by date). It should allow free-text search. It should allow filtering by customer, seller, territory, or any topics.                                                      |
| **FR012**      | Navigation & List Views    | As a user, I want to navigate to view all my territories, sellers, and customers.                                                                                     | The system should provide a navigation menu allowing users to view lists of all their territories, sellers, and customers. Each list view should allow clicking into individual items to view details.                                                                                                                                                                                                                                     |
| **FR013**      | Single User System | As a user, I want this to be a single-user application without authentication requirements.                                                                    | The system is designed for single-user deployment without authentication. Each instance of the application is for one user only. If teammates want to use this application, they should deploy their own instance. No user management or authentication system is required.                                                                                                                                                                |
| **FR014**      | Data Validation Requirements | As a user, I want appropriate validation on required fields when creating entities.                                                                                  | Territory name is required when creating a territory. Seller name is required when creating a seller. Customer name and TPID are required when creating a customer. TPID must be numeric. TPID URL is optional. Topic name is required when creating a topic. Call logs must have content, customer, and date. Topics have names by default but can optionally have descriptions added when editing the topic.                            |
| **FR015**      | Entity Deletion             | As a user, I do not need the ability to delete entities in this initial phase.                                                                                         | The system should not implement deletion functionality for territories, sellers, customers, topics, or call logs in this phase. This functionality may be added in the future.                                                                                                                                                                                                                                                             |
| **FR016**      | Timezone-Aware Timestamps   | As a user, I want created/updated timestamps to display in my browser's local timezone, not UTC.                                                                      | The system should store all datetime values in the database with timezone information (UTC). When displaying created_at and updated_at timestamps in the UI, JavaScript should automatically convert them to the user's local browser timezone. The database uses TIMESTAMPTZ columns and Python uses timezone-aware datetime objects.                                                                                                    |
| **FR017**      | Create Entity Workflow      | As a user, after creating a seller or territory, I want to return to the list page to immediately create another if needed.                                           | When creating a new seller or territory, after successful creation, the system should redirect to the respective list page (sellers or territories) rather than the detail view page. This allows users to see their newly created entity in the list and quickly create additional entities without extra navigation. The success message will still confirm the creation.                                                                |
| **FR018**      | Call Logs Display Layout    | As a user, I want the call logs list to display cleanly with proper clickable areas for customer names, TPIDs, and call content.                                      | The call logs list should display with the call content as the primary clickable link to view details. Customer names should link to customer detail pages, TPIDs should link to external URLs if configured. No nested anchor tags should be used. The layout should show customer name and TPID on one line with the date on the right, followed by call content preview, then badges for seller, territory, and topics.              |
| **FR019**      | Customers List Display Layout | As a user, I want the customers list to display cleanly with proper clickable areas without nested links causing layout issues.                                      | The customers list should avoid nested anchor tags. Customer names should be clickable links to their detail pages, TPIDs should link to external URLs if configured. The layout should show customer name and TPID on one line with call count on the right, followed by badges for seller and territory. No empty clickable areas should appear.                                                                                     |
| **FR020**      | Auto-populate Seller from Customer | As a user, when I create a new call log from a customer page, I want the seller field to be automatically populated if that customer has a seller assigned.       | When navigating to create a new call log with a pre-selected customer (via query parameter), the system should check if that customer has an assigned seller. If so, automatically pre-select that seller in the seller dropdown. This reduces data entry and ensures consistency between customer-seller relationships.                                                                                                               |
| **FR021**      | New Customer from Seller Page      | As a user, when viewing a seller, I want a button to create a new customer for that seller with seller and territory pre-populated.                             | The seller detail page should have a "New Customer" button that redirects to the customer creation form with the seller pre-selected. If that seller has a territory assigned, automatically pre-populate the territory field as well. This streamlines creating customers for specific sellers.                                                                                                                                   |
| **FR022**      | Link to Most Recent Call           | As a user, on the seller page customer list, I want the most recent call timestamp to be a clickable link to that call log.                                     | In the seller detail page's customer table, the "Most Recent Call" column should display the call date/time as a clickable link that navigates directly to that call log's detail page. This provides quick access to the most recent interaction with each customer. Timestamp should display in browser's local timezone with format "Mon DD, YYYY HH:MM AM/PM".                                                                   |
| **FR023**      | Clickable Homepage Cards           | As a user, I want to click anywhere on the homepage statistic cards to navigate to the respective list pages.                                                   | The homepage statistics cards (Call Logs, Customers, Sellers, Topics) should be entirely clickable, not just the "View All" button. Clicking anywhere on the card should navigate to the respective list page. Cards should have hover effects to indicate they are clickable (slight elevation and shadow on hover).                                                                                                              |
| **FR024**      | Date-Only Display in Lists         | As a user, I want call log dates in list views to show only the date without time, but show full date and time when viewing the call log details.              | Call log dates should display as "Mon DD, YYYY" format in all list and summary views (homepage, call logs list, customer view, seller view, topic view, search results). Only the call log detail page should show the full timestamp with time "Month DD, YYYY at HH:MM AM/PM". This reduces visual clutter while keeping detailed timing available when needed.                                                               |
| **FR025**      | Timezone Indicators                | As a user, I want to know what timezone timestamps are being displayed in.                                                                                      | All created/updated timestamps should display the timezone abbreviation (e.g., "PST", "EST") after the time. The system should automatically detect the browser's timezone and display it. Timestamps are stored in UTC in the database and converted to the user's local timezone for display.                                                                                                                                  |
| **FR026**      | Noon Time Special Handling         | As a user, when a call log's time is set to noon (12:00 PM), I want only the date shown without the time.                                                       | If a call log's time is exactly 12:00 PM (noon), the system should display only the date without the time portion in the call log detail view. The label should also change from "Date & Time" to just "Date". This recognizes that noon is often used as a default placeholder time when the exact time isn't important, reducing unnecessary detail display.                                                                    |
| **FR027**      | Create Topics on the Fly           | As a user, when adding topics to a call log, if my search doesn't find any existing topics, I want to press Enter to create a new topic with that name.         | While creating or editing a call log, when typing in the topic search box, if there are no matching existing topics, pressing Enter should create a new topic with the entered name via an AJAX API call. The newly created topic should automatically be added to the call log being edited. This eliminates the need to navigate away to create topics separately and streamlines the call log creation workflow.                    |
| **FR028**      | Quick Call Log Creation from Lists | As a user, I want a "New Call Log" button next to each customer in the customers list and seller detail pages that pre-populates the call log form.            | The customers list page should display a "New Call Log" button next to each customer. The seller detail page's customer table should have a "New Call Log" button in each row. Clicking these buttons should navigate to the call log creation form with the customer pre-selected. If the customer has an assigned seller and territory, those should also be pre-populated automatically. This provides quick access to log new calls without manual navigation and data entry. |
| **FR029**      | Quick Customer Creation from Sellers List | As a user, I want a "New Customer" button next to each seller in the sellers list page that pre-populates the customer form with that seller and their territory. | The sellers list page should display a "New Customer" button next to each seller's customer count. Clicking this button should navigate to the customer creation form with the seller pre-selected. If that seller has a territory assigned, the territory should also be pre-populated automatically. This streamlines the workflow for creating customers assigned to specific sellers. |
| **FR030**      | Show Existing Customers When Creating New Customer | As a user, when creating a new customer and selecting a seller, I want to see a list of that seller's existing customers to prevent creating duplicates. | On the New Customer page, when a seller is selected, a sidebar should display on the right showing all existing customers assigned to that seller. Each customer should show their name, TPID, and be clickable to open in a new tab. If no seller is selected or the seller has no customers, show an informational message. This helps users avoid accidentally creating duplicate customer records. |
| **FR031**      | Return to Referrer After Customer Creation | As a user, after creating a new customer, I want to return to the page I came from. | After successfully creating a customer, redirect back to the referring page (sellers list, seller detail, or customers list). A success flash message provides confirmation that the customer was created. This maintains workflow continuity by keeping the user in their current context rather than navigating away to the newly created customer's detail page. |
| **FR032**      | Create Customer from Territory | As a user, I want to create a customer from the territories page with the territory pre-populated. | The territories list page should have a "New Customer" button for each territory. Clicking this button navigates to the customer creation form with the territory pre-selected. If that territory has only one seller assigned, automatically pre-select that seller as well. This provides another entry point for creating customers organized by territory. |
| **FR033**      | Group Customers by Seller | As a user, I want the customers list page to group customers by their assigned seller. | The customers list page should organize customers into groups by seller. Each group shows the seller name, territory (if assigned), and customer count as a header, followed by the list of customers for that seller. Customers without an assigned seller should be shown in a separate "No Seller Assigned" group at the bottom. Within each group, customers are sorted alphabetically. This provides better organization and context when viewing all customers. |
| **FR034**      | Many-to-Many Seller-Territory Relationship | As a user, I want sellers to be able to be assigned to multiple territories, just like call logs can have multiple topics. | Sellers can be assigned to zero or more territories through a many-to-many relationship. The seller creation and edit pages should provide a searchable territory multi-select picker with keyboard navigation (similar to topic selection in call logs). Territory badges should be displayed on seller list and detail pages. On the customer list page, when a customer is grouped under a seller, the customer's territory badge is hidden if the seller has only one territory assigned (eliminating redundant information), but shown if the seller has multiple territories or no seller is assigned. The database uses a `sellers_territories` association table with foreign keys to both sellers and territories. The old `territory_id` column on sellers is kept for backwards compatibility during transition. |
| **FR035**      | Return to Referrer After Call Log Creation | As a user, after creating a new call log, I want to return to the page I came from instead of viewing the newly created call log. | After successfully creating a call log, redirect back to the referring page (customer detail, seller detail, topic detail, call logs list, or homepage). A success flash message provides confirmation that the call log was created. This maintains workflow continuity by keeping the user in their current context rather than navigating to the new call log's detail page. The referrer is passed as a hidden form field and preserved across form validation errors. |
| **FR036**      | Delete Topics | As a user, I want to be able to delete topics that are no longer needed. | The topic detail page should have a "Delete Topic" button that removes the topic from the database. When a topic is deleted, it is automatically removed from all call logs that were tagged with it (via cascade delete on the many-to-many relationship). A confirmation modal warns the user about the number of call logs that will be affected. After deletion, the user is redirected to the topics list page with a success message. This allows cleanup of obsolete or duplicate topics. |
| **FR037**      | Topic Autocomplete Keyboard Navigation | As a user, when adding topics to a call log, I want to use Tab key to select a suggested topic and Enter key to create a new topic. | While creating or editing a call log, when typing in the topic search box, arrow keys navigate through the autocomplete dropdown suggestions. Pressing Tab selects the currently highlighted suggestion and adds it to the call log. Pressing Enter when there are no suggestions creates a new topic with the entered name. Mouse clicks on dropdown items also work for selection. This provides intuitive keyboard navigation that aligns with standard form behavior (Tab to accept suggestions, Enter to submit). |
| **FR038**      | Customer Page Title Layout | As a user, when viewing customers with long names, I want the customer name, TPID, and action buttons to stay on one line with proper text truncation. | The customer detail page header uses a flexbox layout that keeps the customer name (with truncation), TPID, and action buttons (Edit, New Call Log) on a single line. Long customer names are truncated with ellipsis, and hovering shows a tooltip with the full name. The TPID never wraps and the action buttons never move to a second line. This ensures a clean, consistent layout regardless of customer name length. |
| **FR039**      | Dark Mode with User Preference | As a user, I want to toggle between light and dark mode, and have my preference saved so it persists across sessions. | A dark mode toggle switch is displayed in the navbar (left of the New Call Log button) showing a sun icon in light mode and moon icon in dark mode. Clicking the toggle switches between themes with smooth transitions. The user's preference is stored in the database using a `user_preferences` table with key-value storage. The preference is automatically loaded on every page via a Flask context processor. The dark mode uses Bootstrap 5's native `data-bs-theme` attribute along with custom CSS for cards, list items, and backgrounds to ensure proper contrast and readability. API endpoints (`GET /api/preference/<key>` and `POST /api/preference`) handle preference retrieval and storage. |
| **FR040**      | Customer View Toggle with Preference | As a user, I want to toggle between alphabetical and grouped customer views, and have my preference saved so it persists across sessions. | The customers list page has toggle buttons to switch between alphabetical and grouped views. The alphabetical view (`/customers`) shows all customers in a simple A-Z list with seller and territory badges, optimized for fast loading. The grouped view (`/customers/grouped`) organizes customers by their assigned seller with expandable groups. A "Grouped" button appears on the alphabetical view, and an "Alphabetical" button appears on the grouped view. Clicking either button saves the preference to the database via an API call (`/api/preferences/customer-view`) and navigates to the selected view. The `/customers` route checks the user's preference and redirects to the appropriate view automatically. The preference persists across sessions using the `user_preferences.customer_view_grouped` boolean column. |


```

